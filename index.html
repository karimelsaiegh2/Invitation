<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#fbf6f4" />
  <title>Engagement Invitation | Karim & Nada</title>

  <!--
    ‚úÖ QUICK SETUP
    1) Save this file as: index.html
    2) Put your background photo in the same folder as this HTML named: bg.png
       (Use the image you sent ‚Äî rename it to bg.png)
    3) Add romantic music in the same folder named: music.mp3
    4) (Optional) Google Form:
       - Styled mode submits to Google Form via formResponse.
       - Or switch to embed mode if you prefer.

    This version of the invitation sets the background to the file bg.png.
    All radial and linear gradient overlays that previously layered
    over the image have been removed, so the background is solely the
    provided image.  No functional changes to the JavaScript logic have
    been made.
  -->

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@400;500;600&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#fbf6f4;            /* Ÿàÿ±ÿØ ÿ£ÿ®Ÿäÿ∂ */
      --bg2:#fffaf8;
      --ink:#1f1a18;
      --muted:#6b5f5c;
      --gold:#c9a24a;
      --gold2:#f1d27a;
      --shadow: 0 18px 60px rgba(20, 10, 10, .12);
      --shadow2: 0 8px 22px rgba(20, 10, 10, .10);
      --radius: 22px;
      --bgPhoto: url('bg.png'); /* ‚úÖ Background image file */
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      color:var(--ink);
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: var(--bg);
      overflow-x:hidden;
    }

    /* Photo-only background on the paper wrapper */
    .paper{
      min-height:100vh;
      /* Use only the background image without additional gradients */
      background-image: var(--bgPhoto);
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      position:relative;
      isolation:isolate;
    }

    /* subtle noise overlay */
    .paper::before{
      content:"";
      position:fixed;
      inset:0;
      background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='160' height='160'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.8' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='160' height='160' filter='url(%23n)' opacity='.12'/%3E%3C/svg%3E");
      mix-blend-mode:multiply;
      opacity:.22;
      pointer-events:none;
      z-index:-1;
    }

    /* Canvas glitter layer */
    #glitter{
      position:fixed;
      inset:0;
      width:100vw;
      height:100vh;
      pointer-events:none;
      z-index:50;
    }

    /* Page wrapper */
    .page{
      position:relative;
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:24px 18px;
    }

    /* Page 1: Envelope */
    .envelope-wrap{
      width:min(440px, 92vw);
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:18px;
    }

    .brand{
      font-family:"Cormorant Garamond", serif;
      letter-spacing:.04em;
      text-transform:uppercase;
      font-size:12px;
      color:rgba(60,40,40,.55);
      text-align:center;
    }

    .envelope{
      width:100%;
      aspect-ratio: 16 / 12;
      position:relative;
      border-radius: var(--radius);
      background: linear-gradient(180deg, #fff, #fff7f3);
      box-shadow: var(--shadow);
      overflow:hidden;
      transform: translateY(0);
      transition: transform .9s cubic-bezier(.2,.9,.2,1);
    }

    .envelope::before{
      content:"";
      position:absolute;
      inset:-1px;
      border-radius: var(--radius);
      border:1px solid rgba(201,162,74,.25);
      pointer-events:none;
    }

    .flap{
      position:absolute;
      inset:0;
      transform-origin: top center;
      transform: rotateX(0deg);
      transition: transform 1s cubic-bezier(.2,.9,.2,1);
      backface-visibility:hidden;
    }
    .flap::before{
      content:"";
      position:absolute;
      left:0; right:0; top:-10%;
      margin:auto;
      width:110%;
      height:70%;
      background: linear-gradient(180deg, #fffdfc, #fff2ec);
      clip-path: polygon(50% 95%, 0% 0%, 100% 0%);
      filter: drop-shadow(0 10px 10px rgba(30,10,10,.08));
    }

    .side-left, .side-right{ position:absolute; inset:0; opacity:.92; }
    .side-left::before{
      content:"";
      position:absolute;
      left:-6%;
      top:18%;
      width:62%;
      height:74%;
      background: linear-gradient(180deg, #fff, #fff0ea);
      clip-path: polygon(0% 0%, 100% 50%, 0% 100%);
    }
    .side-right::before{
      content:"";
      position:absolute;
      right:-6%;
      top:18%;
      width:62%;
      height:74%;
      background: linear-gradient(180deg, #fff, #fff0ea);
      clip-path: polygon(100% 0%, 0% 50%, 100% 100%);
    }

    .pocket{ position:absolute; inset:0; overflow:hidden; }
    .pocket::before{
      content:"";
      position:absolute;
      left:0; right:0; bottom:-10%;
      margin:auto;
      width:120%;
      height:75%;
      background: linear-gradient(180deg, #fff7f3, #fff);
      clip-path: polygon(0% 0%, 50% 68%, 100% 0%, 100% 100%, 0% 100%);
      box-shadow: inset 0 1px 0 rgba(201,162,74,.18);
    }

    .letter{
      position:absolute;
      left:7.5%;
      right:7.5%;
      bottom:6.5%;
      height:82%;
      border-radius: 18px;
      background: linear-gradient(180deg, #ffffff, #fff7f4);
      box-shadow: var(--shadow2);
      transform: translateY(38%);
      transition: transform 1.05s cubic-bezier(.2,.9,.2,1);
      display:flex;
      align-items:center;
      justify-content:center;
      padding:24px;
      text-align:center;
    }
    .letter h1{
      font-family:"Cormorant Garamond", serif;
      font-weight:600;
      letter-spacing:.08em;
      margin:0;
      font-size: clamp(22px, 4.6vw, 30px);
      text-transform:uppercase;
    }
    .letter .sub{
      margin-top:10px;
      font-size:13px;
      color:rgba(60,40,40,.55);
      letter-spacing:.08em;
      text-transform:uppercase;
    }

    .seal{
      position:absolute;
      left:50%;
      top:55%;
      transform: translate(-50%, -50%);
      width:72px;
      height:72px;
      border-radius:999px;
      background:
        radial-gradient(circle at 30% 30%, rgba(255,255,255,.45), transparent 40%),
        radial-gradient(circle at 70% 65%, rgba(0,0,0,.10), transparent 55%),
        linear-gradient(135deg, #b8822c, #f1d27a);
      box-shadow: 0 12px 30px rgba(20,10,10,.18);
      display:flex;
      align-items:center;
      justify-content:center;
      color:#2b1b08;
      font-family:"Cormorant Garamond", serif;
      font-weight:600;
      letter-spacing:.10em;
      border:1px solid rgba(255,255,255,.25);
    }

    .cta{ width:100%; display:flex; justify-content:center; }

    .btn{
      appearance:none;
      border:0;
      padding:14px 18px;
      width:min(320px, 92vw);
      border-radius: 999px;
      background: linear-gradient(135deg, rgba(201,162,74,.22), rgba(255,255,255,.85));
      box-shadow: 0 10px 26px rgba(20,10,10,.12);
      color: #2b2018;
      font-weight:600;
      letter-spacing:.09em;
      text-transform:uppercase;
      font-size:12px;
      cursor:pointer;
      position:relative;
      overflow:hidden;
      transition: transform .25s ease, box-shadow .25s ease;
    }
    .btn:active{ transform: translateY(1px) scale(.99); }
    .btn:hover{ box-shadow: 0 14px 30px rgba(20,10,10,.14); }
    .btn::after{
      content:"";
      position:absolute;
      inset:-2px;
      background: radial-gradient(500px 120px at 20% 0%, rgba(241,210,122,.55), transparent 55%);
      opacity:.55;
      pointer-events:none;
      transform: translateX(-30%);
      transition: transform .7s ease;
    }
    .btn:hover::after{ transform: translateX(10%); }

    .hint{
      font-size:12px;
      color:rgba(60,40,40,.55);
      text-align:center;
      line-height:1.35;
      max-width: 44ch;
    }

    .opening .envelope{ transform: translateY(-6px); }
    .opening .flap{ transform: rotateX(160deg); }
    .opening .letter{ transform: translateY(0%); }

    /* Page 2 */
    #page2{ display:none; }
    #page2.active{ display:block; }

    .topbar{
      position:sticky;
      top:0;
      z-index:20;
      backdrop-filter: blur(10px);
      background: rgba(251,246,244,.72);
      border-bottom: 1px solid rgba(201,162,74,.14);
    }

    .topbar-inner{
      width:min(720px, 92vw);
      margin:0 auto;
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding: 12px 0;
    }

    .topbar .mini{
      font-family:"Cormorant Garamond", serif;
      font-weight:600;
      letter-spacing:.08em;
      text-transform:uppercase;
      font-size:12px;
      color: rgba(60,40,40,.75);
    }

    .music{ display:flex; gap:10px; align-items:center; }

    .icon-btn{
      width:44px;
      height:44px;
      border-radius:999px;
      border:1px solid rgba(201,162,74,.24);
      background: rgba(255,255,255,.68);
      box-shadow: 0 10px 24px rgba(20,10,10,.10);
      cursor:pointer;
      display:grid;
      place-items:center;
      transition: transform .2s ease;
    }
    .icon-btn:active{ transform: translateY(1px); }

    .wrap{
      width:min(720px, 92vw);
      margin:0 auto;
      padding: 10px 0 64px;
    }

    .section{ padding: 54px 0; position:relative; }

    .card{
      border-radius: 26px;
      background: rgba(255,255,255,.64);
      border: 1px solid rgba(201,162,74,.16);
      box-shadow: var(--shadow2);
      padding: 26px 18px;
      backdrop-filter: blur(8px);
      transform: translateY(14px);
      opacity:0;
      transition: opacity .85s ease, transform .85s cubic-bezier(.2,.9,.2,1);
    }

    .section.in-view .card{ transform: translateY(0); opacity:1; }

    .kicker{
      font-size:12px;
      letter-spacing:.16em;
      text-transform:uppercase;
      color: rgba(60,40,40,.55);
      margin:0 0 12px;
      text-align:center;
    }

    h2{
      font-family:"Cormorant Garamond", serif;
      font-weight:600;
      margin:0 0 12px;
      text-align:center;
      font-size: clamp(28px, 7vw, 44px);
      letter-spacing:.02em;
    }

    .names{
      display:flex;
      flex-direction:column;
      gap:8px;
      align-items:center;
      justify-content:center;
      margin-top: 10px;
    }
    .names .line{
      font-family:"Cormorant Garamond", serif;
      font-weight:600;
      font-size: clamp(24px, 6.5vw, 38px);
      letter-spacing:.02em;
    }
    .names .amp{
      color: var(--gold);
      letter-spacing:.14em;
      font-size: 12px;
      text-transform:uppercase;
      margin-top: -4px;
    }

    .p{
      margin: 0 auto;
      max-width: 58ch;
      color: rgba(40,25,24,.78);
      font-size: 14px;
      line-height:1.9;
      text-align:center;
    }

    .divider{
      width: 120px;
      height:1px;
      margin: 18px auto;
      background: linear-gradient(90deg, transparent, rgba(201,162,74,.6), transparent);
    }

    .countdown{
      display:grid;
      grid-template-columns: repeat(4, 1fr);
      gap:10px;
      margin-top: 18px;
    }
    .unit{
      border-radius: 18px;
      background: rgba(255,255,255,.72);
      border: 1px solid rgba(201,162,74,.18);
      padding: 12px 10px;
      text-align:center;
    }
    .unit .num{
      font-family:"Cormorant Garamond", serif;
      font-size: 28px;
      font-weight:600;
      letter-spacing:.02em;
    }
    .unit .lab{
      font-size:11px;
      letter-spacing:.16em;
      text-transform:uppercase;
      color: rgba(60,40,40,.55);
      margin-top: 4px;
    }

    .details{ display:grid; gap:12px; margin-top: 18px; }

    .row{
      display:flex;
      gap:10px;
      align-items:flex-start;
      padding: 12px 14px;
      border-radius: 18px;
      background: rgba(255,255,255,.66);
      border: 1px solid rgba(201,162,74,.14);
    }
    .tag{
      width: 28px;
      height: 28px;
      border-radius: 999px;
      display:grid;
      place-items:center;
      background: linear-gradient(135deg, rgba(201,162,74,.24), rgba(255,255,255,.85));
      border: 1px solid rgba(201,162,74,.18);
      flex: 0 0 auto;
      color: rgba(60,40,40,.75);
      font-size: 14px;
    }
    .row b{ display:block; font-size:12px; letter-spacing:.14em; text-transform:uppercase; color: rgba(60,40,40,.55); }
    .row span{ display:block; margin-top:4px; font-size:14px; color: rgba(40,25,24,.8); line-height:1.65; }

    .actions{ display:flex; gap:10px; justify-content:center; margin-top: 18px; flex-wrap:wrap; }

    .chip{
      border: 1px solid rgba(201,162,74,.22);
      background: rgba(255,255,255,.72);
      padding: 12px 16px;
      border-radius: 999px;
      font-size: 12px;
      letter-spacing:.12em;
      text-transform:uppercase;
      color: rgba(50,30,25,.85);
      box-shadow: 0 10px 22px rgba(20,10,10,.08);
      text-decoration:none;
      display:inline-flex;
      gap:8px;
      align-items:center;
    }

    .scroll-down{
      position:fixed;
      left: 10px;
      bottom: 10px;
      z-index: 25;
      font-size: 10px;
      letter-spacing:.22em;
      text-transform:uppercase;
      color: rgba(60,40,40,.50);
      writing-mode: vertical-rl;
      transform: rotate(180deg);
      user-select:none;
      opacity: .85;
      pointer-events:none;
    }

    /* Styled message form */
    .form{ margin-top: 16px; display:grid; gap:10px; }

    .field{
      width:100%;
      border-radius: 16px;
      border: 1px solid rgba(201,162,74,.18);
      background: rgba(255,255,255,.74);
      padding: 12px 14px;
      font: inherit;
      font-size: 14px;
      color: rgba(30,20,18,.9);
      outline:none;
    }
    textarea.field{ min-height: 110px; resize:vertical; }

    .submit{
      margin-top: 6px;
      border:0;
      border-radius: 999px;
      padding: 14px 18px;
      font-weight: 600;
      letter-spacing:.14em;
      text-transform:uppercase;
      background: linear-gradient(135deg, rgba(201,162,74,.30), rgba(255,255,255,.9));
      box-shadow: 0 14px 30px rgba(20,10,10,.12);
      cursor:pointer;
    }

    /* Embedded Google Form */
    .iframe-wrap{
      margin-top: 16px;
      border-radius: 18px;
      overflow:hidden;
      border: 1px solid rgba(201,162,74,.18);
      background: rgba(255,255,255,.72);
      box-shadow: 0 12px 26px rgba(20,10,10,.08);
    }
    .gform-iframe{ width:100%; height: 540px; border:0; display:block; background: transparent; }

    .tiny{
      margin-top: 10px;
      font-size: 12px;
      color: rgba(60,40,40,.55);
      text-align:center;
      line-height:1.55;
    }

    .footer{
      padding: 24px 0 34px;
      text-align:center;
      font-size: 12px;
      color: rgba(60,40,40,.55);
      letter-spacing:.08em;
    }

    @media (max-width: 420px){
      .card{ padding: 22px 16px; }
      .countdown{ gap:8px; }
      .unit .num{ font-size: 26px; }
      .gform-iframe{ height: 620px; }
    }

    @media (prefers-reduced-motion: reduce){
      *{ scroll-behavior:auto !important; }
      .card, .envelope, .flap, .letter{ transition:none !important; }
    }
  </style>
</head>
<body class="paper">
  <canvas id="glitter"></canvas>

  <!-- PAGE 1 -->
  <main id="page1" class="page">
    <div class="envelope-wrap">
      <div class="brand">Engagement Invitation</div>

      <div class="envelope" id="envelope">
        <div class="pocket"></div>
        <div class="side-left"></div>
        <div class="side-right"></div>
        <div class="flap"></div>

        <div class="letter">
          <div>
            <h1>You are INVITED</h1>
            <div class="sub">Karim &amp; Nada</div>
          </div>
        </div>

        <div class="seal">K ‚ô• N</div>
      </div>

      <div class="cta">
        <button class="btn" id="openBtn">CLICK TO OPEN</button>
      </div>

      <div class="hint">A soft romantic soundtrack will start (if your browser allows it). You can mute/unmute anytime.</div>
    </div>
  </main>

  <!-- PAGE 2 -->
  <div id="page2">
    <div class="topbar">
      <div class="topbar-inner">
        <div class="mini">Karim &amp; Nada</div>
        <div class="music">
          <button class="icon-btn" id="musicBtn" aria-label="Toggle music">
            <svg id="musicIcon" width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true">
              <path d="M9 18V6l12-2v12" stroke="rgba(50,30,25,.85)" stroke-width="1.8" stroke-linecap="round"/>
              <path d="M9 6l12-2" stroke="rgba(50,30,25,.85)" stroke-width="1.8" stroke-linecap="round"/>
              <circle cx="7" cy="18" r="3" stroke="rgba(50,30,25,.85)" stroke-width="1.8"/>
              <circle cx="19" cy="16" r="3" stroke="rgba(50,30,25,.85)" stroke-width="1.8"/>
            </svg>
          </button>
        </div>
      </div>
    </div>

    <div class="scroll-down">SCROLL DOWN</div>

    <div class="wrap">
      <section class="section" data-burst="140">
        <div class="card">
          <p class="kicker">You are invited to celebrate</p>
          <h2>Engagement</h2>
          <div class="divider"></div>
          <div class="names">
            <div class="line">Karim</div>
            <div class="amp">and</div>
            <div class="line">Nada</div>
          </div>
          <div class="divider"></div>
          <p class="p">With hearts full of joy, we would be honored by your presence.</p>
        </div>
      </section>

      <section class="section" data-burst="170">
        <div class="card">
          <p class="kicker">Countdown</p>
          <h2>See you soon</h2>
          <div class="divider"></div>
          <div class="countdown" aria-label="Countdown timer">
            <div class="unit"><div class="num" id="d">00</div><div class="lab">Days</div></div>
            <div class="unit"><div class="num" id="h">00</div><div class="lab">Hours</div></div>
            <div class="unit"><div class="num" id="m">00</div><div class="lab">Minutes</div></div>
            <div class="unit"><div class="num" id="s">00</div><div class="lab">Seconds</div></div>
          </div>
          <p class="tiny" id="countNote">Counting down from the moment you opened this link.</p>
        </div>
      </section>

      <section class="section" data-burst="180">
        <div class="card">
          <p class="kicker">Details</p>
          <h2>Event Info</h2>
          <div class="divider"></div>

          <div class="details">
            <div class="row"><div class="tag">‚ú¶</div><div><b>Groom</b><span>Karim</span></div></div>
            <div class="row"><div class="tag">‚ú¶</div><div><b>Bride</b><span>Nada</span></div></div>
            <div class="row"><div class="tag">‚ú¶</div><div><b>Date</b><span>26 December 2025</span></div></div>
            <div class="row"><div class="tag">‚ú¶</div><div><b>Venue</b><span>Al Saraya Hall ‚Äî after Cataract Hotel, Saqqara Touristic Road</span></div></div>
          </div>

          <div class="actions">
            <a class="chip" id="mapsBtn" href="https://maps.app.goo.gl/M5KgciodwTRpr6V96" target="_blank" rel="noopener">üìç Location on Google Maps</a>
          </div>

          <p class="tiny">Tip: Tap the location button to open Google Maps.</p>
        </div>
      </section>

      <section class="section" data-burst="160">
        <div class="card">
          <p class="kicker">A gentle note</p>
          <h2>Our Moment</h2>
          <div class="divider"></div>
          <p class="p">Your presence means the world to us. Thank you for being part of our story.</p>
        </div>
      </section>

      <section class="section" data-burst="230" id="messagesSection">
        <div class="card">
          <p class="kicker">Leave a message</p>
          <h2>For the couple</h2>
          <div class="divider"></div>

          <!-- Premium Styled Form (default) -->
          <form class="form" id="msgForm" method="POST" target="hidden_iframe">
            <input class="field" id="guestName" name="entry.NAME" placeholder="Your name" autocomplete="name" required />
            <textarea class="field" id="guestMsg" name="entry.MESSAGE" placeholder="Write your message‚Ä¶" required></textarea>
            <button class="submit" type="submit">Send Message</button>
          </form>
          <iframe name="hidden_iframe" style="display:none;"></iframe>

          <!-- Embedded Google Form (fallback) -->
          <div class="iframe-wrap" id="embedWrap" aria-label="Google Form" style="display:none;">
            <iframe class="gform-iframe" id="gformEmbed" src="" title="Message to the couple" loading="lazy">Loading‚Ä¶</iframe>
          </div>

          <div class="tiny" id="formStatus"></div>
        </div>
      </section>

      <section class="section" data-burst="220">
        <div class="card">
          <p class="kicker">With love</p>
          <h2>Karim &amp; Nada</h2>
          <div class="divider"></div>
          <p class="p">We can‚Äôt wait to celebrate together.</p>
        </div>
      </section>

      <div class="footer">¬© 2025 ‚Äî Engagement Invitation</div>
    </div>
  </div>

  <audio id="bgm" preload="auto" loop src="music.mp3"></audio>

  <script>
    // =========================
    // CONFIG
    // =========================
    const CONFIG = {
      musicSrc: "music.mp3",
      eventISO: "2025-12-26T19:00:00+02:00",
      mapsSearchQuery: "ŸÇÿßÿπÿ© ÿßŸÑÿ≥ÿ±ÿßŸäÿß ÿ®ÿπÿØ ŸÅŸÜÿØŸÇ ŸÉÿ™ÿßÿ±ŸÉÿ™ ÿ∑ÿ±ŸäŸÇ ÿ≥ŸÇÿßÿ±ÿ© ÿßŸÑÿ≥Ÿäÿßÿ≠Ÿä",

      // "styled" => premium custom form (sends to Google Form formResponse)
      // "embed"  => embedded Google Form iframe
      formMode: "styled",

      googleForm: {
        // You sent one entry key: entry.186419149
        // If your prefilled link contains ONLY ONE entry, we will submit name+message combined into that one field.
        // If it contains TWO entries, we will map name+message separately.
        prefilledUrl: "https://docs.google.com/forms/d/e/1FAIpQLSc1pqGrzKXntzeJT9gn11RsFuinEr8a9Nip4nWYPOc23ac9tw/viewform?usp=pp_url&entry.186419149=...........",
        action: "https://docs.google.com/forms/d/e/1FAIpQLSc1pqGrzKXntzeJT9gn11RsFuinEr8a9Nip4nWYPOc23ac9tw/formResponse",
        entryName: "",
        entryMessage: "",
        embedUrl: "https://docs.google.com/forms/d/e/1FAIpQLSc1pqGrzKXntzeJT9gn11RsFuinEr8a9Nip4nWYPOc23ac9tw/viewform?embedded=true"
      }
    };

    // =========================
    // DOM refs
    // =========================
    const page1 = document.getElementById('page1');
    const page2 = document.getElementById('page2');
    const openBtn = document.getElementById('openBtn');
    const envelope = document.getElementById('envelope');

    const audio = document.getElementById('bgm');
    const musicBtn = document.getElementById('musicBtn');
    const musicIcon = document.getElementById('musicIcon');

    const mapsBtn = document.getElementById('mapsBtn');

    const msgForm = document.getElementById('msgForm');
    const formStatus = document.getElementById('formStatus');
    const guestName = document.getElementById('guestName');
    const guestMsg = document.getElementById('guestMsg');

    // Countdown elements
    const elD = document.getElementById('d');
    const elH = document.getElementById('h');
    const elM = document.getElementById('m');
    const elS = document.getElementById('s');

    // =========================
    // Glitter / Stars Canvas
    // =========================
    const canvas = document.getElementById('glitter');
    const ctx = canvas.getContext('2d');

    let W = 0, H = 0, DPR = Math.max(1, Math.min(2, window.devicePixelRatio || 1));

    function resizeCanvas(){
      W = Math.floor(window.innerWidth);
      H = Math.floor(window.innerHeight);
      canvas.width = Math.floor(W * DPR);
      canvas.height = Math.floor(H * DPR);
      canvas.style.width = W + 'px';
      canvas.style.height = H + 'px';
      ctx.setTransform(DPR, 0, 0, DPR, 0, 0);
    }
    resizeCanvas();
    window.addEventListener('resize', resizeCanvas, { passive:true });

    const particles = [];
    const rand = (min, max) => Math.random() * (max - min) + min;

    function drawStar(x, y, r, rot){
      ctx.save();
      ctx.translate(x, y);
      ctx.rotate(rot);
      ctx.beginPath();
      for (let i=0; i<10; i++){
        const ang = i * Math.PI / 5;
        const rad = (i % 2 === 0) ? r : r * 0.45;
        ctx.lineTo(Math.cos(ang) * rad, Math.sin(ang) * rad);
      }
      ctx.closePath();
      ctx.fill();
      ctx.restore();
    }

    function addParticle(x, y, vX, vY, size, life, spin){
      particles.push({
        x, y,
        vx: vX,
        vy: vY,
        size,
        life,
        maxLife: life,
        rot: rand(0, Math.PI * 2),
        spin,
        tw: rand(0, Math.PI * 2),
        kind: Math.random() < 0.78 ? 'star' : 'dot'
      });
    }

    function burst(x, y, count=120, spread=1){
      for (let i=0; i<count; i++){
        const a = rand(-Math.PI, 0);
        const sp = rand(0.6, 4.2) * spread;
        const vx = Math.cos(a) * sp + rand(-0.8, 0.8);
        const vy = Math.sin(a) * sp + rand(-0.4, 0.4);
        const size = rand(1.2, 3.4);
        const life = rand(55, 115);
        const spin = rand(-0.08, 0.08);
        addParticle(x + rand(-22, 22), y + rand(-12, 12), vx, vy, size, life, spin);
      }
    }

    function trail(count=14){
      for (let i=0; i<count; i++){
        const x = rand(0, W);
        const y = H + rand(0, 16);
        const vx = rand(-0.25, 0.25);
        const vy = rand(-2.6, -0.9);
        const size = rand(1.0, 2.6);
        const life = rand(60, 130);
        addParticle(x, y, vx, vy, size, life, rand(-0.06, 0.06));
      }
    }

    let lastFrame = 0;
    function tick(t){
      const dt = Math.min(32, t - lastFrame || 16);
      lastFrame = t;

      ctx.clearRect(0, 0, W, H);

      const grad = ctx.createLinearGradient(0, 0, W, 0);
      grad.addColorStop(0, "rgba(201,162,74,0.95)");
      grad.addColorStop(0.5, "rgba(241,210,122,0.95)");
      grad.addColorStop(1, "rgba(201,162,74,0.95)");
      ctx.fillStyle = grad;

      for (let i=particles.length-1; i>=0; i--){
        const p = particles[i];
        p.life -= dt / 16;
        if (p.life <= 0){ particles.splice(i, 1); continue; }

        p.x += p.vx * (dt / 16);
        p.y += p.vy * (dt / 16);
        p.vy -= 0.01 * (dt / 16);
        p.vx *= 0.995;
        p.vy *= 0.995;

        p.rot += p.spin * (dt / 16);
        p.tw += 0.07 * (dt / 16);

        const alpha = Math.max(0, Math.min(1, p.life / p.maxLife));
        const twinkle = 0.55 + 0.45 * Math.sin(p.tw);

        ctx.globalAlpha = alpha * twinkle;

        if (p.kind === 'dot'){
          ctx.beginPath();
          ctx.arc(p.x, p.y, p.size * 0.7, 0, Math.PI * 2);
          ctx.fill();
        } else {
          drawStar(p.x, p.y, p.size, p.rot);
        }
      }

      ctx.globalAlpha = 1;
      requestAnimationFrame(tick);
    }
    requestAnimationFrame(tick);

    // =========================
    // Page 1 -> Page 2
    // =========================
    function showPage2(){
      page1.style.display = 'none';
      page2.classList.add('active');
      burst(W * 0.5, H * 0.35, 180, 1.15);
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function tryPlayAudio(){
      // ‚úÖ Music file name
      // Put "music.mp3" next to this HTML (same folder)
      if (!audio.src) audio.src = CONFIG.musicSrc;
      audio.volume = 0.55;
      const p = audio.play();
      if (p && typeof p.then === 'function'){
        p.then(() => setMusicUI(true)).catch(() => setMusicUI(false));
      } else {
        setMusicUI(!audio.paused);
      }
    }

    function setMusicUI(isOn){
      musicBtn.dataset.on = isOn ? '1' : '0';
      musicIcon.style.opacity = isOn ? '1' : '.55';
    }

    openBtn.addEventListener('click', () => {
      document.body.classList.add('opening');
      const rect = envelope.getBoundingClientRect();
      burst(rect.left + rect.width * 0.5, rect.top + rect.height * 0.45, 260, 1.45);
      burst(rect.left + rect.width * 0.25, rect.top + rect.height * 0.55, 180, 1.25);
      burst(rect.left + rect.width * 0.75, rect.top + rect.height * 0.55, 180, 1.25);

      // Play the background music immediately when the user clicks to open.
      tryPlayAudio();

      setTimeout(() => {
        showPage2();
        initScrollAnimations();
        initCountdown();
        attachForm();
        // Ensure music is playing after the second page is displayed
        tryPlayAudio();
      }, 860);
    });

    musicBtn?.addEventListener('click', async () => {
      if (!audio.src) audio.src = CONFIG.musicSrc;
      if (audio.paused){
        try {
          await audio.play();
          setMusicUI(true);
          burst(W - 60, 80, 100, 0.95);
        } catch {
          setMusicUI(false);
        }
      } else {
        audio.pause();
        setMusicUI(false);
        burst(W - 60, 80, 80, 0.80);
      }
    });

    // Maps button
    // Set the location link to open the specified URL directly.
    mapsBtn.href = "https://maps.app.goo.gl/M5KgciodwTRpr6V96";

    // Scroll reveal + glitter transitions
    let lastScrollY = 0;
    let scrollAccum = 0;

    function initScrollAnimations(){
      const sections = Array.from(document.querySelectorAll('.section'));
      const io = new IntersectionObserver((entries) => {
        for (const e of entries){
          if (e.isIntersecting){
            e.target.classList.add('in-view');
            const burstCount = Number(e.target.getAttribute('data-burst') || 120);
            const r = e.target.getBoundingClientRect();
            burst(r.left + r.width/2, Math.min(H * 0.85, r.top + r.height/2), burstCount, 1.05);
          }
        }
      }, { threshold: 0.25 });

      sections.forEach(s => io.observe(s));

      window.addEventListener('scroll', () => {
        const y = window.scrollY || 0;
        const dy = Math.abs(y - lastScrollY);
        lastScrollY = y;
        scrollAccum += dy;

        if (scrollAccum > 90){
          scrollAccum = 0;
          trail(20);
        } else if (scrollAccum > 45){
          trail(12);
        }
      }, { passive:true });

      setInterval(() => {
        if (!page2.classList.contains('active')) return;
        trail(10);
      }, 850);
    }

    // Countdown
    const pad2 = (n) => {
      const s = String(Math.max(0, Math.floor(n)));
      return s.length < 2 ? '0' + s : s;
    };

    function initCountdown(){
      const target = new Date(CONFIG.eventISO);
      function render(){
        const now = new Date();
        const diff = target.getTime() - now.getTime();

        if (diff <= 0){
          elD.textContent = '00';
          elH.textContent = '00';
          elM.textContent = '00';
          elS.textContent = '00';
          const note = document.getElementById('countNote');
          if (note) note.textContent = 'Today is the day ‚ú¶ See you there.';
          return;
        }

        const sec = Math.floor(diff / 1000);
        const days = Math.floor(sec / 86400);
        const hours = Math.floor((sec % 86400) / 3600);
        const mins = Math.floor((sec % 3600) / 60);
        const secs = sec % 60;

        elD.textContent = pad2(days);
        elH.textContent = pad2(hours);
        elM.textContent = pad2(mins);
        elS.textContent = pad2(secs);
      }
      render();
      setInterval(render, 1000);
    }

    // Google Form integration
    function attachForm(){
      const embedWrap = document.getElementById('embedWrap');
      const gformEmbed = document.getElementById('gformEmbed');

      if (CONFIG.formMode === 'embed'){
        msgForm.style.display = 'none';
        embedWrap.style.display = 'block';
        gformEmbed.src = CONFIG.googleForm.embedUrl;
        formStatus.innerHTML = "If the form doesn‚Äôt load, <a href=\"https://docs.google.com/forms/d/e/1FAIpQLSc1pqGrzKXntzeJT9gn11RsFuinEr8a9Nip4nWYPOc23ac9tw/viewform\" target=\"_blank\" rel=\"noopener\" style=\"color:inherit; text-decoration:underline;\">open it here</a>.";
        return;
      }

      // Styled mode
      msgForm.style.display = 'grid';
      embedWrap.style.display = 'none';

      // Auto-detect entry IDs from prefilled link
      if (CONFIG.googleForm.prefilledUrl){
        try {
          const u = new URL(CONFIG.googleForm.prefilledUrl);
          CONFIG.googleForm.action = (u.origin + u.pathname).replace('/viewform', '/formResponse');

          const entryKeys = [];
          u.searchParams.forEach((_, k) => {
            if (k.startsWith('entry.')) entryKeys.push(k);
          });

          if (entryKeys.length >= 2){
            CONFIG.googleForm.entryName = CONFIG.googleForm.entryName || entryKeys[0];
            CONFIG.googleForm.entryMessage = CONFIG.googleForm.entryMessage || entryKeys[1];
          } else if (entryKeys.length === 1){
            CONFIG.googleForm.entryMessage = CONFIG.googleForm.entryMessage || entryKeys[0];
          }
        } catch {}
      }

      if (!CONFIG.googleForm.action || !CONFIG.googleForm.entryMessage){
        formStatus.textContent = "Google Form not ready. Please paste a pre-filled link that includes entry IDs.";
        msgForm.addEventListener('submit', (e) => {
          e.preventDefault();
          burst(W * 0.5, H * 0.7, 120, 1.05);
          formStatus.textContent = "Saved locally on this device (Google Form not connected yet).";
          try {
            const saved = { name: guestName.value.trim(), msg: guestMsg.value.trim(), at: new Date().toISOString() };
            localStorage.setItem('couple_message_latest', JSON.stringify(saved));
          } catch {}
        }, { once:true });
        return;
      }

      msgForm.action = CONFIG.googleForm.action;

      if (CONFIG.googleForm.entryName){
        guestName.name = CONFIG.googleForm.entryName;
      } else {
        guestName.removeAttribute('name');
      }

      guestMsg.name = CONFIG.googleForm.entryMessage;

      msgForm.addEventListener('submit', () => {
        if (!CONFIG.googleForm.entryName){
          const n = guestName.value.trim();
          const m = guestMsg.value.trim();
          guestMsg.value = n ? `Name: ${n}\n\nMessage: ${m}` : m;
        }
        burst(W * 0.5, H * 0.7, 230, 1.28);
        setTimeout(() => {
          formStatus.textContent = "Thank you ‚ú¶ Your message has been sent.";
          guestName.value = "";
          guestMsg.value = "";
        }, 700);
      });

      formStatus.textContent = CONFIG.googleForm.entryName
        ? "Your message will be saved to Google Form ‚ú¶"
        : "Your message will be saved to Google Form ‚ú¶ (Name will be included inside the message)";
    }

    // Optional direct open: ?open=1
    if (new URLSearchParams(location.search).get('open') === '1'){
      page1.style.display = 'none';
      page2.classList.add('active');
      initScrollAnimations();
      initCountdown();
      attachForm();
      tryPlayAudio();
      burst(W * 0.5, H * 0.35, 180, 1.1);
    } else {
      // idle glitter on page1
      setInterval(() => {
        if (page2.classList.contains('active')) return;
        const r = envelope.getBoundingClientRect();
        burst(r.left + r.width * rand(0.35, 0.65), r.top + r.height * rand(0.3, 0.55), 34, 0.75);
      }, 1100);
    }
  </script>
</body>
</html>